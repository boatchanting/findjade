<!DOCTYPE html>
<html>
<head>
    <title>ç‰çŸ¿è¿·è¸ª - å¯»å®å¤§å†’é™©</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        body {
            display: flex;
            flex-direction: column;
            align-items: center;
            font-family: 'Microsoft YaHei', 'Segoe UI', sans-serif;
            background-color: #f3f3f3;
            margin: 0;
            padding: 20px;
            touch-action: manipulation;
        }
        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            width: 100%;
            max-width: 400px;
            margin-bottom: 20px;
        }
        header h1 {
            font-size: 1.5em;
            color: #107C10;
            margin: 0;
        }
        button {
            background-color: #107C10;
            color: white;
            border: none;
            border-radius: 5px;
            padding: 10px 20px;
            font-size: 1em;
            cursor: pointer;
            transition: background-color 0.3s;
        }

        button:hover {
            background-color: #0B5A0B;
        }

        #reset {
            background-color: #107C10;
            color: white;
            border: none;
            border-radius: 5px;
            padding: 10px 20px;
            font-size: 1em;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        #reset:hover {
            background-color: #0B5A0B;
        }
        #game {
            display: grid;
            grid-template-columns: repeat(10, 40px);
            gap: 3px;
            background-color: #e6e6e6;
            padding: 15px;
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }
        .cell {
            width: 40px;
            height: 40px;
            background-color: #fefefe;
            border: 1px solid #cccccc;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            user-select: none;
            border-radius: 5px;
            transition: all 0.2s;
            touch-action: none;
        }
        .cell:hover {
            transform: scale(1.05);
            box-shadow: 0 0 8px rgba(0, 0, 0, 0.2);
        }
        .revealed {
            background-color: #f0f8f0;
            cursor: default;
            transform: none;
            box-shadow: none;
        }
        .jade {
            background-color: #a8d8b9;
            color: #0a4f0a;
            font-weight: bold;
        }
        .flag {
            background-color: #ffd700;
            background-image: linear-gradient(45deg, transparent 50%, #ffec99 50%);
        }
        .hidden {
            visibility: hidden;
        }
        footer {
            margin-top: 20px;
            font-size: 0.9em;
            color: #666;
        }
        #status-container {
            display: flex;
            justify-content: space-between;
            width: 100%;
            max-width: 400px;
            margin: 15px 0;
        }
        #counter, #found {
            font-size: 1.2em;
            color: #107C10;
        }
        .rank {
            font-size: 1.5em;
            font-weight: bold;
            margin: 20px 0;
        }
        /* è§„åˆ™å¼¹çª—æ ·å¼ */
        #rulesModal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.8);
            justify-content: center; /* æ°´å¹³å±…ä¸­ */
            align-items: center; /* å‚ç›´å±…ä¸­ */
        }

        .modal-content {
            background-color: #fefefe;
            padding: 20px;
            border: 1px solid #888;
            width: 80%;
            max-width: 500px;
            border-radius: 10px;
        }

        .close {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
        }

        .close:hover {
            color: black;
            cursor: pointer;
        }

        .rule-item {
            margin: 15px 0;
            padding-left: 20px;
            line-height: 1.6;
        }

        .rule-title {
            color: #107C10;
            font-weight: bold;
        }
        
        /*ç‰çŸ³å›¾ç‰‡æ ·å¼*/
        .jade-img {
            width: 80%;           
            height: 80%;
            pointer-events: none; /* é¿å…å›¾ç‰‡æŒ¡ä½ç‚¹å‡» */
        }

        .game-logo {
            height: 200px;
            object-fit: contain;
        }


        @media (max-width: 480px) {
            #game {
                grid-template-columns: repeat(10, 35px);
                gap: 2px;
            }
            .cell {
                width: 35px;
                height: 35px;
            }
            #status-container {
                flex-direction: column;
                align-items: center;
            }
            #counter, #found {
                margin: 5px 0;
            }
        }
    </style>
</head>
<body>
    <header>
        <h1><img src="logo.png" alt="Logo" style="vertical-align: middle; width: 50px; height: 50px;"> ç‰çŸ¿è¿·è¸ª</h1>
        <button onclick="showRules()">æ¸¸æˆè§„åˆ™</button>
        <button id="reset">é‡æ–°å¼€å§‹</button>
    </header>
    <div id="game"></div>
    <div id="status-container">
        <div id="counter">å°è¯•æ¬¡æ•°ï¼š0</div>
        <div id="found">å·²æ‰¾åˆ°ï¼š0/15</div>
    </div>
    <div id="status">å¯»æ‰¾æ‰€æœ‰15å—ç‰çŸ³ï¼</div>
    <!-- è§„åˆ™å¼¹çª— -->
    <div id="rulesModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeRules()">&times;</span>
            <h2 style="color: #107C10">æ¸¸æˆè§„åˆ™</h2>
            
            <div class="rule-item">
                <div class="rule-title">æ¸¸æˆç›®æ ‡</div>
                <div>åœ¨10x10çš„çŸ¿åŒºä¸­æ‰¾åˆ°å…¨éƒ¨15å—éšè—ç‰çŸ³</div>
            </div>
            
            <div class="rule-item">
                <div class="rule-title">æ“ä½œæ–¹å¼</div>
                <div>ç”µè„‘ï¼šå·¦é”®æŒ–æ˜ / å³é”®æ ‡è®°</div>
                <div>æ‰‹æœºï¼šçŸ­æŒ‰æŒ–æ˜ / é•¿æŒ‰æ ‡è®°</div>
            </div>
            
            <div class="rule-item">
                <div class="rule-title">æ¸¸æˆæœºåˆ¶</div>
                <div>1. æŒ–åˆ°ç‰çŸ³ ğŸ’ï¼šæˆåŠŸæ”¶é›†</div>
                <div>2. æŒ–åˆ°ç©ºçŸ¿ï¼šæ˜¾ç¤ºå‘¨å›´ç‰çŸ³æ•°é‡</div>
                <div>3. æ•°å­—æç¤ºï¼šæ˜¾ç¤ºè¯¥æ ¼å‘¨å›´8æ ¼çš„ç‰çŸ³æ•°é‡</div>
            </div>
            
            <div class="rule-item">
                <div class="rule-title">èƒœè´Ÿåˆ¤å®š</div>
                <div>èƒœåˆ©ï¼šæ‰¾åˆ°å…¨éƒ¨15å—ç‰çŸ³</div>
                <div>å¤±è´¥ï¼šæŒ–åˆ°ç©ºçŸ¿ï¼ˆä¼šæ˜¾ç¤ºæ‰€æœ‰ç‰çŸ³ä½ç½®ï¼‰</div>
            </div>
            
            <div class="rule-item">
                <div class="rule-title">æ®µä½ç³»ç»Ÿ</div>
                <div>â‰¤20æ¬¡ï¼šå¯»ç‰å®—å¸ˆ ğŸ“</div>
                <div>21-30æ¬¡ï¼šé‡‡çŸ¿ä¸“å®¶ ğŸ”¨</div>
                <div>31-40æ¬¡ï¼šæ¢å®èƒ½æ‰‹ ğŸª“</div>
                <div>ï¼40æ¬¡ï¼šæ–°æ‰‹çŸ¿å·¥ ğŸ§’</div>
            </div>
            
            <div class="rule-item">
                <div class="rule-title">ç‰¹æ®ŠåŠŸèƒ½</div>
                <div>ğŸš© æ ‡è®°ï¼šé•¿æŒ‰/å³é”®æ ‡è®°å¯ç–‘ä½ç½®</div>
                <div>å±•å¼€ï¼šæŒ–åˆ°ç©ºç™½åŒºåŸŸä¼šè‡ªåŠ¨å±•å¼€</div>
                <div>é‡ç½®æŒ‰é’®ï¼šéšæ—¶é‡æ–°å¼€å§‹æ¸¸æˆ</div>
            </div>
        </div>
    </div>
    <footer>
        <img src="logo.png" alt="ç‰çŸ³æŒ–æ˜æ¸¸æˆ" class="game-logo">
    </footer>
    

    <script>
        const GRID_SIZE = 10;
        const JADE_COUNT = 15;
        let board = [];
        let found = 0;
        let clickCount = 0;
        let jadeLocations = [];
        let gameOver = false;
        let longPressTimer = null;
        const LONG_PRESS_TIME = 500; // 0.5ç§’é•¿æŒ‰

        const rankLevels = [
            { max: 20, title: "å¯»ç‰å®—å¸ˆ ğŸ“" },
            { max: 30, title: "é‡‡çŸ¿ä¸“å®¶ ğŸ”¨" },
            { max: 40, title: "æ¢å®èƒ½æ‰‹ ğŸª“" },
            { max: Infinity, title: "æ–°æ‰‹çŸ¿å·¥ ğŸ§’" }
        ];

        function createBoard() {
            const game = document.getElementById('game');
            game.innerHTML = '';
            board = [];
            found = 0;
            clickCount = 0;
            jadeLocations = [];
            gameOver = false;
            document.getElementById('status').textContent = `å¯»æ‰¾æ‰€æœ‰15å—ç‰çŸ³ï¼`;
            document.getElementById('counter').textContent = 'å°è¯•æ¬¡æ•°ï¼š0';
            document.getElementById('found').textContent = 'å·²æ‰¾åˆ°ï¼š0/15';

            for (let i = 0; i < GRID_SIZE * GRID_SIZE; i++) {
                const cell = document.createElement('div');
                cell.classList.add('cell');
                
                // ç§»åŠ¨ç«¯è§¦æ‘¸äº‹ä»¶
                cell.addEventListener('touchstart', (e) => handleTouchStart(e, i));
                cell.addEventListener('touchend', (e) => handleTouchEnd(e, i));
                cell.addEventListener('touchcancel', (e) => handleTouchEnd(e, i));
                
                // æ¡Œé¢ç«¯å›é€€æ–¹æ¡ˆ
                cell.addEventListener('click', () => revealCell(i));
                cell.addEventListener('contextmenu', (e) => {
                    e.preventDefault();
                    toggleFlag(i);
                });

                game.appendChild(cell);
                board.push({ jade: false, revealed: false, flagged: false, adjacent: 0 });
            }

            placeJades();
            calculateAdjacent();
        }

        function handleTouchStart(e, index) {
            e.preventDefault();
            if (gameOver) return;

            longPressTimer = setTimeout(() => {
                toggleFlag(index);
                longPressTimer = null;
            }, LONG_PRESS_TIME);
        }

        function handleTouchEnd(e, index) {
            if (longPressTimer) {
                clearTimeout(longPressTimer);
                longPressTimer = null;
                if (!gameOver && !board[index].flagged) {
                    revealCell(index);
                }
            }
        }

        function placeJades() {
            let jadesPlaced = 0;
            while (jadesPlaced < JADE_COUNT) {
                const idx = Math.floor(Math.random() * board.length);
                if (!board[idx].jade) {
                    board[idx].jade = true;
                    jadeLocations.push(idx);
                    jadesPlaced++;
                }
            }
        }

        function calculateAdjacent() {
            for (let i = 0; i < board.length; i++) {
                if (!board[i].jade) {
                    const count = countAdjacentJades(i);
                    board[i].adjacent = count;
                }
            }
        }

        function countAdjacentJades(index) {
            const x = index % GRID_SIZE;
            const y = Math.floor(index / GRID_SIZE);
            let count = 0;

            for (let dy = -1; dy <= 1; dy++) {
                for (let dx = -1; dx <= 1; dx++) {
                    if (dx === 0 && dy === 0) continue;
                    const newX = x + dx;
                    const newY = y + dy;
                    if (newX >= 0 && newX < GRID_SIZE && newY >= 0 && newY < GRID_SIZE) {
                        const idx = newY * GRID_SIZE + newX;
                        if (board[idx].jade) count++;
                    }
                }
            }

            return count;
        }

        function revealCell(index, isAuto = false) {
            if (gameOver || board[index].revealed || board[index].flagged) return;

            if (!isAuto) {
                clickCount++;
                document.getElementById('counter').textContent = `å°è¯•æ¬¡æ•°ï¼š${clickCount}`;
            }

            const cell = document.getElementsByClassName('cell')[index];
            board[index].revealed = true;
            cell.classList.add('revealed');

            if (board[index].jade) {
                cell.innerHTML = '<img src="yu.png" alt="ç‰çŸ³" class="jade-img">';
                cell.classList.add('jade');
                found++;
                document.getElementById('found').textContent = `å·²æ‰¾åˆ°ï¼š${found}/15`;
                checkWin();
                return;
            }

            if (board[index].adjacent > 0) {
                cell.textContent = board[index].adjacent;
                cell.style.color = getNumberColor(board[index].adjacent);
            } else {
                for (let dy = -1; dy <= 1; dy++) {
                    for (let dx = -1; dx <= 1; dx++) {
                        const x = index % GRID_SIZE + dx;
                        const y = Math.floor(index / GRID_SIZE) + dy;
                        if (x >= 0 && x < GRID_SIZE && y >= 0 && y < GRID_SIZE) {
                            const idx = y * GRID_SIZE + x;
                            if (!board[idx].revealed) revealCell(idx, true);
                        }
                    }
                }
            }
        }

        function toggleFlag(index) {
            if (gameOver || board[index].revealed) return;

            const cell = document.getElementsByClassName('cell')[index];
            board[index].flagged = !board[index].flagged;
            cell.classList.toggle('flag');
            cell.textContent = board[index].flagged ? 'âš‘' : '';
        }

        function checkWin() {
            if (found === JADE_COUNT) {
                gameOver = true;
                const rank = getRank(clickCount);
                document.getElementById('status').innerHTML = `
                    <div class="rank">${rank.title}</div>
                    ç”¨${clickCount}æ¬¡å°è¯•å®ŒæˆæŒ‘æˆ˜ï¼
                `;
                revealAllJades();
            }
        }

        function getRank(count) {
            return rankLevels.find(r => count <= r.max) || rankLevels[rankLevels.length-1];
        }

        function revealAllJades() {
            jadeLocations.forEach(idx => {
                const cell = document.getElementsByClassName('cell')[idx];
                cell.innerHTML = '<img src="yu.png" alt="ç‰çŸ³" class="jade-img">';
                cell.classList.add('jade', 'revealed');
            });
        }

        function getNumberColor(number) {
            const colors = ['#333', '#0078D4', '#00CC6A', '#FF4D4D', '#800080', '#800000', '#008080', '#000000', '#808080'];
            return colors[number - 1] || '#000';
        }

        document.getElementById('reset').addEventListener('click', createBoard);
        createBoard();

        // è§„åˆ™å¼¹çª—æ§åˆ¶
        function showRules() {
            document.getElementById('rulesModal').style.display = 'flex';
        }

        function closeRules() {
            document.getElementById('rulesModal').style.display = 'none';
        }

        document.getElementById('status').innerHTML = `
            ç‚¹å‡»"æ¸¸æˆè§„åˆ™"æŸ¥çœ‹ç©æ³•<br>
            é•¿æŒ‰/å³é”®æ ‡è®°ç©ºç™½ä½ç½®ï¼Œé¿å…ä¸å¿…è¦çš„æŒ–æ˜å“¦
        `;
        document.getElementById('status').style.textAlign = 'center';
    </script>

</body>
</html>